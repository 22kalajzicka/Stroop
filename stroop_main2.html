<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Main Stroop Task</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    margin-top: 50px;
  }
  #word {
    font-size: 48px;
    margin: 50px;
  }
  #feedback {
    font-size: 20px;
    margin-top: 30px;
  }
</style>
</head>
<body>
<div id="word"></div>
<div id="feedback"></div>

<script>
const colors = ["red", "green", "blue", "yellow"];
const keys = {r: "red", g: "green", b: "blue", y: "yellow"};
const totalTrials = 40;
let i = 0;

// Arrays to store data
let words = [], inks = [], pressedKeys = [], correctness = [], rts = [];

function randomChoice(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function makeTrial() {
  const word = randomChoice(colors);
  const ink = randomChoice(colors.filter(c => c !== word)); // always incongruent
  return { word, ink };
}

function nextTrial() {
  if (i >= totalTrials) {
    const accuracy = (correctness.filter(c => c === 1).length / correctness.length * 100).toFixed(1);
    const avgRT = Math.round(rts.reduce((a, b) => a + b, 0) / rts.length);

    document.getElementById("word").innerHTML = "Task complete!";
    document.getElementById("feedback").innerHTML = `
      <br>Accuracy: ${accuracy}%<br>
      Average RT: ${avgRT} ms<br>
      Sending results to Qualtrics...
    `;

    // Send results to Qualtrics parent
    window.parent.postMessage({
      stroop_words: words.join("|"),
      stroop_inks: inks.join("|"),
      stroop_pressed: pressedKeys.join("|"),
      stroop_correct: correctness.join("|"),
      stroop_rt: rts.join("|"),
      stroop_accuracy: accuracy,
      stroop_avgRT: avgRT
    }, "*");

    return;
  }

  const trial = makeTrial();
  const wordEl = document.getElementById("word");
  const feedbackEl =
